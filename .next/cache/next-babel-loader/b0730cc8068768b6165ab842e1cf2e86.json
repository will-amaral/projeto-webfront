{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport Router from 'next/router';\nimport cookie from 'js-cookie';\nimport nextCookie from 'next-cookies';\nimport { setHeader } from './api';\nexport function login(token) {\n  cookie.set('token', token, {\n    expires: 1\n  });\n  Router.push('/');\n}\nexport function logout() {\n  cookie.remove('token');\n  Router.push('/login');\n}\nexport function auth(ctx) {\n  var _nextCookie = nextCookie(ctx),\n      token = _nextCookie.token;\n\n  if (ctx.req && !token) {\n    console.log('Não existem cookies');\n    ctx.res.writeHead(302, {\n      Location: '/login'\n    });\n    ctx.res.end();\n  }\n\n  if (!token) {\n    console.log('Não existe token');\n    Router.push('/login');\n  }\n\n  console.log('Cookie: ' + token);\n  return token;\n}\nexport function withAuth(WrappedComponent) {\n  function Wrapper(props) {\n    return __jsx(WrappedComponent, props);\n  }\n\n  Wrapper.getInitialProps =\n  /*#__PURE__*/\n  function () {\n    var _ref = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee(ctx) {\n      var token, componentProps;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              token = auth(ctx);\n              setHeader(token);\n              _context.t0 = WrappedComponent.getInitialProps;\n\n              if (!_context.t0) {\n                _context.next = 7;\n                break;\n              }\n\n              _context.next = 6;\n              return WrappedComponent.getInitialProps(ctx);\n\n            case 6:\n              _context.t0 = _context.sent;\n\n            case 7:\n              componentProps = _context.t0;\n              return _context.abrupt(\"return\", _objectSpread({}, componentProps, {\n                token: token\n              }));\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return Wrapper;\n}","map":null,"metadata":{},"sourceType":"module"}