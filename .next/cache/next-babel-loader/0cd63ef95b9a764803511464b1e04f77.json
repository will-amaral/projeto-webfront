{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nvar _jsxFileName = \"/home/will/Documents/School/projeto-ifsp/webfront/utils/auth.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport Router from 'next/router';\nimport cookie from 'js-cookie';\nimport nextCookie from 'next-cookies';\nimport { setHeader } from './api';\nexport function login(token) {\n  cookie.set('token', token, {\n    expires: 1\n  });\n  Router.push('/');\n}\nexport function logout() {\n  cookie.remove('token');\n  Router.push('/login');\n}\nexport function auth(ctx) {\n  var _nextCookie = nextCookie(ctx),\n      token = _nextCookie.token;\n\n  if (ctx.req && !token) {\n    console.log('N達o existem cookies');\n    ctx.res.writeHead(302, {\n      Location: '/login'\n    });\n    ctx.res.end();\n  }\n\n  if (!token) {\n    console.log('N達o existe token');\n    Router.push('/login');\n  }\n\n  console.log('Cookie: ' + token);\n  return token;\n}\nexport function withAuth(WrappedComponent) {\n  function Wrapper(props) {\n    return __jsx(WrappedComponent, _extends({}, props, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 35\n      },\n      __self: this\n    }));\n  }\n\n  Wrapper.getInitialProps =\n  /*#__PURE__*/\n  function () {\n    var _ref = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee(ctx) {\n      var token, componentProps;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              token = auth(ctx);\n              setHeader(token);\n              _context.t0 = WrappedComponent.getInitialProps;\n\n              if (!_context.t0) {\n                _context.next = 7;\n                break;\n              }\n\n              _context.next = 6;\n              return WrappedComponent.getInitialProps(ctx);\n\n            case 6:\n              _context.t0 = _context.sent;\n\n            case 7:\n              componentProps = _context.t0;\n              return _context.abrupt(\"return\", _objectSpread({}, componentProps, {\n                token: token\n              }));\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return Wrapper;\n}","map":{"version":3,"sources":["/home/will/Documents/School/projeto-ifsp/webfront/utils/auth.js"],"names":["Router","cookie","nextCookie","setHeader","login","token","set","expires","push","logout","remove","auth","ctx","req","console","log","res","writeHead","Location","end","withAuth","WrappedComponent","Wrapper","props","getInitialProps","componentProps"],"mappings":";;;;;;;AAAA,OAAOA,MAAP,MAAmB,aAAnB;AACA,OAAOC,MAAP,MAAmB,WAAnB;AACA,OAAOC,UAAP,MAAuB,cAAvB;AACA,SAASC,SAAT,QAA0B,OAA1B;AAEA,OAAO,SAASC,KAAT,CAAeC,KAAf,EAAsB;AACzBJ,EAAAA,MAAM,CAACK,GAAP,CAAW,OAAX,EAAoBD,KAApB,EAA2B;AAAEE,IAAAA,OAAO,EAAE;AAAX,GAA3B;AACAP,EAAAA,MAAM,CAACQ,IAAP,CAAY,GAAZ;AACH;AAED,OAAO,SAASC,MAAT,GAAkB;AACrBR,EAAAA,MAAM,CAACS,MAAP,CAAc,OAAd;AACAV,EAAAA,MAAM,CAACQ,IAAP,CAAY,QAAZ;AACH;AAED,OAAO,SAASG,IAAT,CAAcC,GAAd,EAAmB;AAAA,oBACJV,UAAU,CAACU,GAAD,CADN;AAAA,MACdP,KADc,eACdA,KADc;;AAGtB,MAAIO,GAAG,CAACC,GAAJ,IAAW,CAACR,KAAhB,EAAuB;AACnBS,IAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AACAH,IAAAA,GAAG,CAACI,GAAJ,CAAQC,SAAR,CAAkB,GAAlB,EAAuB;AAAEC,MAAAA,QAAQ,EAAE;AAAZ,KAAvB;AACAN,IAAAA,GAAG,CAACI,GAAJ,CAAQG,GAAR;AACH;;AAED,MAAI,CAACd,KAAL,EAAY;AACRS,IAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ;AACAf,IAAAA,MAAM,CAACQ,IAAP,CAAY,QAAZ;AACH;;AACDM,EAAAA,OAAO,CAACC,GAAR,CAAY,aAAaV,KAAzB;AACA,SAAOA,KAAP;AACH;AAED,OAAO,SAASe,QAAT,CAAkBC,gBAAlB,EAAoC;AACvC,WAASC,OAAT,CAAiBC,KAAjB,EAAwB;AACpB,WAAO,MAAC,gBAAD,eAAsBA,KAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAP;AACH;;AAEDD,EAAAA,OAAO,CAACE,eAAR;AAAA;AAAA;AAAA;AAAA;AAAA,6BAA0B,iBAAeZ,GAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAChBP,cAAAA,KADgB,GACRM,IAAI,CAACC,GAAD,CADI;AAEtBT,cAAAA,SAAS,CAACE,KAAD,CAAT;AAFsB,4BAKlBgB,gBAAgB,CAACG,eALC;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAMXH,gBAAgB,CAACG,eAAjB,CAAiCZ,GAAjC,CANW;;AAAA;AAAA;;AAAA;AAIhBa,cAAAA,cAJgB;AAAA,iEAQVA,cARU;AAQMpB,gBAAAA,KAAK,EAALA;AARN;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA1B;;AAAA;AAAA;AAAA;AAAA;;AAWA,SAAOiB,OAAP;AACD","sourcesContent":["import Router from 'next/router';\nimport cookie from 'js-cookie';\nimport nextCookie from 'next-cookies';\nimport { setHeader } from './api';\n\nexport function login(token) {\n    cookie.set('token', token, { expires: 1 });\n    Router.push('/')\n}\n\nexport function logout() {\n    cookie.remove('token');\n    Router.push('/login');\n}\n\nexport function auth(ctx) {\n    const { token } = nextCookie(ctx);\n\n    if (ctx.req && !token) {\n        console.log('N達o existem cookies')\n        ctx.res.writeHead(302, { Location: '/login' });\n        ctx.res.end()\n    }\n\n    if (!token) {\n        console.log('N達o existe token')\n        Router.push('/login');\n    }\n    console.log('Cookie: ' + token)\n    return token\n}\n\nexport function withAuth(WrappedComponent) {\n    function Wrapper(props) {\n        return <WrappedComponent {...props} />\n    }\n  \n    Wrapper.getInitialProps = async function(ctx) {\n        const token = auth(ctx);\n        setHeader(token);\n      \n        const componentProps =\n            WrappedComponent.getInitialProps &&\n            (await WrappedComponent.getInitialProps(ctx))\n  \n        return { ...componentProps, token }\n    }\n  \n    return Wrapper\n  }"]},"metadata":{},"sourceType":"module"}